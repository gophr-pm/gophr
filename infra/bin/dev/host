#! /bin/bash

# Constants
DOMAIN_ALIAS="gophr.dev"
NEW_LINE_CHAR="
"
HOSTS_FILE_PATH="/etc/hosts"
DOCKER_MACHINE_NAME="gophr-dev"

echo "Attaching the '$DOMAIN_ALIAS' domain to the gophr dev docker machine..."

docker_machine_ip=$(docker-machine ip $DOCKER_MACHINE_NAME)
# Used to check if 'DOMAIN_ALIAS' is in the hosts file
domain_alias_entry=$(sudo grep -E "^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\s+${DOMAIN_ALIAS}$" --color=never ${HOSTS_FILE_PATH})

if [[ -z "$domain_alias_entry" ]]; then
  # This means that there is gophr dev host yet, so we must append it
  echo "${NEW_LINE_CHAR}${docker_machine_ip} ${DOMAIN_ALIAS}" | sudo tee -a $HOSTS_FILE_PATH 1> /dev/null 2> /dev/null
else
  # This means that there is a gophr dev host, so we must replace it
  sudo sed -E -e "s/${domain_alias_entry}/${docker_machine_ip} ${DOMAIN_ALIAS}/" -i "" $HOSTS_FILE_PATH 1> /dev/null 2> /dev/null
fi

# Color variables
esc_seq="\x1b["
no_color=$esc_seq"39;49;00m"
green_color=$esc_seq"32;01m"

echo -e "${green_color}âœ“ Gophr dev domain attached successfully!${no_color}"
