#! /bin/bash

# Constants
DOCKER_MACHINE_NAME="gophr-staging"

# Color variables
esc_seq="\x1b["
no_color=$esc_seq"39;49;00m"
red_color=$esc_seq"31;01m"
green_color=$esc_seq"32;01m"

# Exit on error
set -e

# Only expose the the port if it isn't exposed already
if [[ -z "$(ps aux | grep "[d]ocker-machine ssh $DOCKER_MACHINE_NAME -N -L 8080:localhost:8080")" ]]; then
  echo -e "${green_color}✓ Kubernetes port exposed successfully!${no_color}"
  docker-machine start $DOCKER_MACHINE_NAME 1> /dev/null 2> /dev/null || true;
  docker-machine ssh "$DOCKER_MACHINE_NAME" -N -L 8080:localhost:8080 &
else
  echo -e "${red_color}✗ Kubernetes port is already exposed.${no_color}"
  exit 1
fi
